{"version":3,"file":"src_pages_Proposals_tsx.fc4b5b31.js","mappings":"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","sources":["webpack://@nepoche/stats-dapp/./src/pages/Proposals.tsx"],"sourcesContent":["import { ColumnDef, createColumnHelper, getCoreRowModel, Table as RTTable, useReactTable } from '@tanstack/react-table';\nimport { useStatsContext } from '@nepoche/stats-dapp/provider/stats-provider';\nimport {\n  Button,\n  Card,\n  CardTable,\n  LabelWithValue,\n  Stats,\n  Table,\n  TitleWithInfo,\n} from '@nepoche/webb-ui-components/components';\nimport { fuzzyFilter } from '@nepoche/webb-ui-components/components/Filter/utils';\nimport { ExternalLinkLine, TokenIcon } from '@nepoche/webb-ui-components/icons';\nimport { Typography } from '@nepoche/webb-ui-components/typography';\nimport { shortenHex } from '@nepoche/webb-ui-components/utils';\nimport { ArcElement, Chart as ChartJS, Legend } from 'chart.js';\nimport { BigNumber } from 'ethers';\nimport React, { useMemo, useState } from 'react';\nimport { Link, Outlet } from 'react-router-dom';\n\nimport { DonutChartContainer, ProposalsTable, TimeRange } from '../containers';\nimport { ProposalListItem, ProposalStatus, useProposalsOverview } from '../provider/hooks';\n\nconst columnHelper = createColumnHelper<ProposalListItem>();\n\nconst columns: ColumnDef<ProposalListItem, any>[] = [\n  columnHelper.accessor('height', {\n    header: 'Height',\n    cell: (props) => BigNumber.from(props.getValue<string>()).div(1000).toBigInt().toLocaleString(),\n  }),\n\n  columnHelper.accessor('type', {\n    header: 'Type',\n  }),\n\n  columnHelper.accessor('txHash', {\n    header: 'Tx Hash',\n    cell: (props) => (\n      <div className='flex items-center space-x-1'>\n        <LabelWithValue\n          labelVariant='body3'\n          label='tx hash:'\n          isHiddenLabel\n          value={shortenHex(props.getValue<string>(), 3)}\n          valueTooltip={props.getValue<string>()}\n        />\n        <a href='#'>\n          <ExternalLinkLine />\n        </a>\n      </div>\n    ),\n  }),\n\n  columnHelper.accessor('chain', {\n    header: 'Chain',\n    cell: () => <TokenIcon name='eth' size='lg' />,\n  }),\n\n  columnHelper.accessor('id', {\n    header: '',\n    cell: (props) => (\n      <Button variant='link' size='sm'>\n        <Link to={`drawer/${props.getValue<string>()}`}>Details</Link>\n      </Button>\n    ),\n  }),\n];\n\nChartJS.register(ArcElement, Legend);\n\nconst Proposals = () => {\n  const {\n    blockTime,\n    metaData: { activeSession, lastProcessBlock },\n  } = useStatsContext();\n\n  const [timeRange, setTimeRange] = useState<TimeRange>('Day');\n\n  const range = useMemo(() => {\n    let rangeTimeSec = undefined;\n    switch (timeRange) {\n      case 'Day':\n        rangeTimeSec = 24 * 60 * 60;\n        break;\n      case 'Week':\n        rangeTimeSec = 24 * 60 * 60 * 7;\n        break;\n      case 'Year':\n        rangeTimeSec = 24 * 60 * 60 * 365;\n        break;\n      case 'All Time':\n        rangeTimeSec = undefined;\n    }\n    if (!rangeTimeSec) {\n      return { start: 0, end: Number(lastProcessBlock) };\n    }\n    const end = Number(lastProcessBlock);\n    const start = Math.floor(Math.max(Number(lastProcessBlock) - rangeTimeSec / blockTime, 0));\n    return {\n      end,\n      start,\n    };\n  }, [timeRange, lastProcessBlock, blockTime]);\n\n  const overview = useProposalsOverview(activeSession, range);\n\n  const data = useMemo(() => {\n    if (overview.val) {\n      return overview.val.openProposals.length > 5\n        ? overview.val.openProposals.slice(0, 5)\n        : overview.val.openProposals;\n    }\n    return [] as ProposalListItem[];\n  }, [overview]);\n\n  const statsMap: Record<ProposalStatus, number> = useMemo(() => {\n    if (overview.val) {\n      const { accepted, open, rejected, signed } = overview.val.stats;\n      return {\n        [ProposalStatus.Signed]: signed,\n        [ProposalStatus.Rejected]: rejected,\n        [ProposalStatus.Open]: open,\n        [ProposalStatus.Accepted]: accepted,\n        [ProposalStatus.FailedToExecute]: 0,\n        [ProposalStatus.Executed]: 0,\n        [ProposalStatus.Removed]: 0,\n      };\n    }\n    return {\n      [ProposalStatus.Signed]: 0,\n      [ProposalStatus.Rejected]: 0,\n      [ProposalStatus.Open]: 0,\n      [ProposalStatus.Accepted]: 0,\n      [ProposalStatus.FailedToExecute]: 0,\n      [ProposalStatus.Executed]: 0,\n      [ProposalStatus.Removed]: 0,\n    };\n  }, [overview]);\n\n  const statsItems = useMemo<React.ComponentProps<typeof Stats>['items']>(() => {\n    const proposalsThreshold = overview.val ? overview.val.thresholds.proposal : 'NaN';\n    const proposers = overview.val ? overview.val.thresholds.proposers : 'NaN';\n    return [\n      {\n        titleProps: {\n          title: 'Proposal Threshold',\n          info: 'Proposal Threshold',\n        },\n        value: proposalsThreshold,\n      },\n      {\n        titleProps: {\n          title: 'Proposers',\n          info: 'Proposers',\n        },\n        value: proposers,\n      },\n    ];\n  }, [overview]);\n\n  const table = useReactTable<ProposalListItem>({\n    columns: columns,\n    data,\n    getCoreRowModel: getCoreRowModel(),\n    filterFns: {\n      fuzzy: fuzzyFilter,\n    },\n  });\n\n  const noOpenProposals = useMemo(() => data.length === 0, [data]);\n\n  return (\n    <div className='flex flex-col space-y-4'>\n      {/** Proposals Status */}\n      <Card>\n        <TitleWithInfo title='Proposals Status' variant='h5' info='Proposals Status' />\n\n        <Stats items={statsItems} />\n      </Card>\n\n      <div className='flex space-x-4'>\n        {/* * Proposal Types */}\n        <DonutChartContainer\n          timeRange={timeRange}\n          setTimeRange={setTimeRange}\n          isLoading={overview.isLoading}\n          statsMap={statsMap}\n        />\n\n        {/** Open Proposals */}\n        <CardTable titleProps={{ title: 'Open Proposals' }} className='flex flex-col grow'>\n          {noOpenProposals ? (\n            <div className='flex items-center justify-center min-w-full grow'>\n              <Typography ta={'center'} variant={'h4'}>\n                No open proposals\n              </Typography>\n            </div>\n          ) : (\n            <Table tableProps={table as RTTable<unknown>} />\n          )}\n        </CardTable>\n      </div>\n\n      {/** All Proposals */}\n      <ProposalsTable />\n\n      <Outlet />\n    </div>\n  );\n};\n\nexport default Proposals;\n"],"names":["createColumnHelper","getCoreRowModel","useReactTable","useStatsContext","Button","Card","CardTable","LabelWithValue","Stats","Table","TitleWithInfo","fuzzyFilter","ExternalLinkLine","TokenIcon","Typography","shortenHex","ArcElement","Chart","ChartJS","Legend","BigNumber","React","useMemo","useState","Link","Outlet","DonutChartContainer","ProposalsTable","ProposalStatus","useProposalsOverview","columnHelper","columns","accessor","header","cell","props","from","getValue","div","toBigInt","toLocaleString","register","Proposals","blockTime","metaData","activeSession","lastProcessBlock","timeRange","setTimeRange","range","rangeTimeSec","undefined","start","end","Number","Math","floor","max","overview","data","val","openProposals","length","slice","statsMap","stats","accepted","open","rejected","signed","Signed","Rejected","Open","Accepted","FailedToExecute","Executed","Removed","statsItems","proposalsThreshold","thresholds","proposal","proposers","titleProps","title","info","value","table","filterFns","fuzzy","noOpenProposals","isLoading"],"sourceRoot":""}